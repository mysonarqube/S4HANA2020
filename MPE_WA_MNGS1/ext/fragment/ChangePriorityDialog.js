/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/model/resource/ResourceModel","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(R,J,M){"use strict";return{initAndOpen:function(v,a){this._oView=v;this.oAssignedActivitySelectedItem=a;if(!this.oChangePriorityDialog){this.oChangePriorityDialog=sap.ui.xmlfragment("ChangePriority","i2d.mpe.workassign.manages1.ext.fragment.ChangePriorityDialog",this);this.oChangePriorityDialog.setModel(v.getModel("i18n"),"i18n");}var p=a.MfgOpActyExecutionPriority;sap.ui.getCore().byId(sap.ui.core.Fragment.createId("ChangePriority","idPriority")).setValue(p);sap.ui.getCore().byId(sap.ui.core.Fragment.createId("ChangePriority","idPrioritySave")).setEnabled(true);this.oChangePriorityDialog.open();return this.oChangePriorityDialog;},onChangePriorityDialogCancel:function(e){this.oChangePriorityDialog.close();},onChangePriorityDialogSave:function(e){var p=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("ChangePriority","idPriority")).getValue();this._updatePriority(this.oAssignedActivitySelectedItem,p);},onPriorityChange:function(e){if(e.getParameter("value")>32767||e.getParameter("value")<0){sap.ui.getCore().byId(sap.ui.core.Fragment.createId("ChangePriority","idPrioritySave")).setEnabled(false);}else{sap.ui.getCore().byId(sap.ui.core.Fragment.createId("ChangePriority","idPrioritySave")).setEnabled(true);}},_updatePriority:function(a,p){var t=this;var m=this._oView.getModel();var T=sap.ui.getCore().byId("assignmentsTable");sap.ui.core.BusyIndicator.show();m.callFunction("/C_OpActyUserAssgmtTPSet_exec_prio",{method:"POST",urlParameters:{"OpActyNtwkElement":a.OpActyNtwkElement,"OpActyNtwkInstance":a.OpActyNtwkInstance,"UserID":a.UserID,"OaExecPrio":p},success:function(d,r){if(t.oChangePriorityDialog){t.oChangePriorityDialog.close();}sap.ui.core.BusyIndicator.hide();T.getBinding("items").refresh();sap.m.MessageToast.show(JSON.parse(r.headers["sap-message"]).message);T.removeSelections();sap.ui.getCore().byId("changePriorityButton").setEnabled(false);},error:function(e){var r=e.responseText;if(r!==undefined){T.removeSelections();sap.ui.getCore().byId("changePriorityButton").setEnabled(false);var s=JSON.parse(r).error.message.value;sap.ui.core.BusyIndicator.hide();sap.m.MessageBox.error(s,{actions:[sap.m.MessageBox.Action.CLOSE]});}}});}};});
