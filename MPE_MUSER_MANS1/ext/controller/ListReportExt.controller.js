/*
 * Copyright (C) 2009-2020 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.controller("i2d.mpe.mfguser.manages1.ext.controller.ListReportExt",{onInit:function(){var l=this.getView().byId(this.createId("listReportFilter"));var t=this;l.attachInitialized(function(e){var f=e.getSource();f._getFilterItemByName("BusinessPartnerName").setLabel(t.getOwnerComponent().getModel("i18n").getResourceBundle().getText("UsernameFilter"));f.setShowMessages(false);});},onBeforeRebindTableExtension:function(e){var p=e.getParameters();p.bindingParams.sorter.push(new sap.ui.model.Sorter("BusinessPartnerName"));},onClickUserAddButton:function(e){if(!this.AddBusinessPartnerDialog){this.AddBusinessPartnerDialog=sap.ui.xmlfragment("AddBusinessPartnerDialog","i2d.mpe.mfguser.manages1.ext.fragment.AddBusinessPartner",this);this.getView().addDependent(this.AddBusinessPartnerDialog);this.AddBusinessPartnerDialog.setModel(this.getOwnerComponent().getModel('i18n'),"i18n");}var v=this.getView();var c=v.getModel().createEntry("/C_MfgBusinessPartnerTP",{groupId:"Changes",changeSetId:"Changes",batchGroupId:"Changes",method:"POST"},{success:$.proxy(function(D){},this),error:jQuery.proxy(function(E){var C=!!this.getView().$().closest(".sapUiSizeCompact").length;this.getView().setBusy(false);sap.m.MessageBox.error(JSON.parse(E.responseText).error.message.value,{styleClass:C?"sapUiSizeCompact":""});},this)});if(c){this.AddBusinessPartnerDialog.setBindingContext(c);this.AddBusinessPartnerDialog.open();}},onChange:function(e){var s=e.getSource();var p=s._getBindingContext().getPath();var b=s.getBindingInfo("value");var a=b.parts[0].path;var n=e.getParameters().newValue;this.getOwnerComponent().getModel().setProperty(""+p+"/"+a+"",n);},onCreateBPAddPress:function(e){var p=this.AddBusinessPartnerDialog.getBindingContext().getPath();var v=this.getOwnerComponent().getModel().getProperty(p);if(v.MfgBusinessPartner===undefined){var E=this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("enterBP");sap.ui.getCore().byId(sap.ui.core.Fragment.createId("AddBusinessPartnerDialog","MfgBusinessPartner")).setValueState(sap.ui.core.ValueState.Error);sap.m.MessageToast.show(E);this.AddBusinessPartnerDialog.setBusy(false);}else if(v.WorkCenter!==undefined&&v.WorkCenter.length>8){E=this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("workCenterTooLong");sap.ui.getCore().byId(sap.ui.core.Fragment.createId("AddBusinessPartnerDialog","WorkCenter")).setValueState(sap.ui.core.ValueState.Error);sap.m.MessageToast.show(E);this.AddBusinessPartnerDialog.setBusy(false);}else if(v.Plant!==undefined&&v.Plant.length>4){E=this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("plantTooLong");sap.ui.getCore().byId(sap.ui.core.Fragment.createId("AddBusinessPartnerDialog","Plant")).setValueState(sap.ui.core.ValueState.Error);sap.m.MessageToast.show(E);this.AddBusinessPartnerDialog.setBusy(false);}else{this.getOwnerComponent().getModel().submitChanges({groupId:"Changes",changeSetId:"Changes",batchGroupId:"Changes",success:$.proxy(function(s){var p=this.AddBusinessPartnerDialog.getBindingContext().getPath();var a=this.getOwnerComponent().getModel().getProperty(p).BusinessPartnerName;var r=s.__batchResponses[s.__batchResponses.length-1];var b=Object.keys(r);var c=false;for(var i in b){if(b[i]==="__changeResponses"){c=true;}}if(c){if(r.__changeResponses[r.__changeResponses.length-1].statusCode==="201"){var m=this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("manufacturingUserAddSuccessMsg",[a]);sap.m.MessageToast.show(m);this.AddBusinessPartnerDialog.close();}}else{var d=s.__batchResponses[0].response.body;var f=JSON.parse(d);var E="";if(f.error.code==="MPE_USER_GROUP_MSGS/004"||f.error.code==="MPE_USER_GROUP_MSGS/005"||f.error.code==="MPE_USER_GROUP_MSGS/006"){sap.ui.getCore().byId(sap.ui.core.Fragment.createId("AddBusinessPartnerDialog","MfgBusinessPartner")).setValueState(sap.ui.core.ValueState.Error);}else if(f.error.code==="MPE_USER_GROUP_MSGS/007"||f.error.code==="MPE_USER_GROUP_MSGS/008"){sap.ui.getCore().byId(sap.ui.core.Fragment.createId("AddBusinessPartnerDialog","WorkCenter")).setValueState(sap.ui.core.ValueState.Error);}else if(f.error.code==="MPE_USER_GROUP_MSGS/018"||f.error.code==="MPE_USER_GROUP_MSGS/019"){sap.ui.getCore().byId(sap.ui.core.Fragment.createId("AddBusinessPartnerDialog","Plant")).setValueState(sap.ui.core.ValueState.Error);}else if(f.error.code==="MPE_USER_GROUP_MSGS/025"){sap.ui.getCore().byId(sap.ui.core.Fragment.createId("AddBusinessPartnerDialog","WorkCenter")).setValueState(sap.ui.core.ValueState.Error);sap.ui.getCore().byId(sap.ui.core.Fragment.createId("AddBusinessPartnerDialog","Plant")).setValueState(sap.ui.core.ValueState.Error);}else if(f.error.code==="MPE_USER_GROUP_MSGS/027"){this.getOwnerComponent().getModel().resetChanges();this.AddBusinessPartnerDialog.close();}E=f.error.message.value;sap.m.MessageToast.show(E);}var I=this.createId("listReport");this.getView().byId(I).rebindTable();},this),error:$.proxy(function(a){this.getOwnerComponent().getModel().resetChanges();this.AddBusinessPartnerDialog.close();},this)});}sap.ui.getCore().getMessageManager().removeAllMessages();},onCreateBPClosePress:function(e){this.getOwnerComponent().getModel().resetChanges();sap.ui.getCore().getMessageManager().removeAllMessages();this.AddBusinessPartnerDialog.close();},onClickUserEditButton:function(e){var a=this.extensionAPI;if(a.getSelectedContexts().length>0){if(!this.EditBusinessPartnerDialog){this.EditBusinessPartnerDialog=sap.ui.xmlfragment("EditBusinessPartnerDialog","i2d.mpe.mfguser.manages1.ext.fragment.EditBusinessPartner",this);this.EditBusinessPartnerDialog.setModel(this.getOwnerComponent().getModel("i18n"),"i18n");this.getView().addDependent(this.EditBusinessPartnerDialog);}var p=a.getSelectedContexts();var P=p[0].sPath;this.EditBusinessPartnerDialog.bindElement(P);sap.ui.getCore().byId(sap.ui.core.Fragment.createId("EditBusinessPartnerDialog","WorkCenter")).setValueState(sap.ui.core.ValueState.None);sap.ui.getCore().byId(sap.ui.core.Fragment.createId("EditBusinessPartnerDialog","Plant")).setValueState(sap.ui.core.ValueState.None);this.EditBusinessPartnerDialog.open();}},onEditBPOKPress:function(e){var p=this.EditBusinessPartnerDialog.getBindingContext().getPath();var w=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("EditBusinessPartnerDialog","WorkCenter")).getValue();var a=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("EditBusinessPartnerDialog","Plant")).getValue();var b=this.getOwnerComponent().getModel().getProperty(p).BusinessPartnerName;if(w.length>8){var E=this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("workCenterTooLong");sap.ui.getCore().byId(sap.ui.core.Fragment.createId("EditBusinessPartnerDialog","WorkCenter")).setValueState(sap.ui.core.ValueState.Error);sap.m.MessageToast.show(E);this.EditBusinessPartnerDialog.setBusy(false);}else if(a.length>4){E=this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("plantTooLong");sap.ui.getCore().byId(sap.ui.core.Fragment.createId("EditBusinessPartnerDialog","Plant")).setValueState(sap.ui.core.ValueState.Error);sap.m.MessageToast.show(E);this.EditBusinessPartnerDialog.setBusy(false);}else{if(this.getOwnerComponent().getModel().hasPendingChanges()){this.getOwnerComponent().getModel().submitChanges({success:jQuery.proxy(function(d){this.EditBusinessPartnerDialog.setBusy(false);var r=d.__batchResponses[d.__batchResponses.length-1];var c=Object.keys(r);var f=false;for(var i in c){if(c[i]==="__changeResponses"){f=true;}}if(f){if(r.__changeResponses[r.__changeResponses.length-1].statusCode==="204"){var u=this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("userEditSuccessMsg",[b]);sap.m.MessageToast.show(u);this.EditBusinessPartnerDialog.close();}}else{var g=d.__batchResponses[0].response.body;var h=JSON.parse(g);var E="";if(h.error.code==="MPE_USER_GROUP_MSGS/007"||h.error.code==="MPE_USER_GROUP_MSGS/008"||h.error.code==="MPE_USER_GROUP_MSGS/033"){sap.ui.getCore().byId(sap.ui.core.Fragment.createId("EditBusinessPartnerDialog","WorkCenter")).setValueState(sap.ui.core.ValueState.Error);}else if(h.error.code==="MPE_USER_GROUP_MSGS/018"||h.error.code==="MPE_USER_GROUP_MSGS/019"){sap.ui.getCore().byId(sap.ui.core.Fragment.createId("EditBusinessPartnerDialog","Plant")).setValueState(sap.ui.core.ValueState.Error);}else if(h.error.code==="MPE_USER_GROUP_MSGS/025"){sap.ui.getCore().byId(sap.ui.core.Fragment.createId("EditBusinessPartnerDialog","WorkCenter")).setValueState(sap.ui.core.ValueState.Error);sap.ui.getCore().byId(sap.ui.core.Fragment.createId("EditBusinessPartnerDialog","Plant")).setValueState(sap.ui.core.ValueState.Error);}else if(h.error.code==="MPE_USER_GROUP_MSGS/027"){this.getOwnerComponent().getModel().resetChanges();this.EditBusinessPartnerDialog.close();}E=h.error.message.value;sap.m.MessageToast.show(E);}this.getOwnerComponent().getModel().refresh(true);},this),error:jQuery.proxy(function(c){var n=this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("networkErrorMsg");sap.m.MessageToast.show(n);this.getOwnerComponent().getModel().refresh(true);this.EditBusinessPartnerDialog.close();},this)});}else{this.EditBusinessPartnerDialog.close();}}sap.ui.getCore().getMessageManager().removeAllMessages();},onEditBPClosePress:function(e){this.getOwnerComponent().getModel().resetChanges();sap.ui.getCore().getMessageManager().removeAllMessages();this.EditBusinessPartnerDialog.close();}});
